<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Wikipedia Tracer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <link href="./bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="./style.css" rel="stylesheet">

    <link href="./bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/gsap/1.9.6/TweenMax.min.js"></script>
    <script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v4.5.0.min.js"></script>
    <script src="WikipediaTracer.js"></script>

    <script>
        $(document).ready(function(){
          
            $("#input").val("Blue")

            wk = new WikipediaTracer()

            wk.updateCallback = function () {
                
                var latestItem = wk.chain[wk.chain.length - 1]

                var payload = $("<a>").attr("href", latestItem.link).append(latestItem.name)

                var carrier = $("<tr>").addClass("chain-element").append(
                    $("<td>").append(
                        payload
                    )
                ).append(
                    $("<td>").append(
                        ""
                    )
                )
                

                $("#chainBody").append(carrier)

                $("html, body").scrollTop($(document).height())
            }

            wk.doneCallback = function () {
                $("#submit,#getRandom").removeAttr("disabled")

                $(".chain-element:eq(" + wk.loopBackIndex + ")").addClass("info")

                var badge = $("<span>").addClass("label label-success").append("Loop!")

                $(".chain-element:eq(" + wk.loopBackIndex + ")").children("td:eq(1)").append(badge)

                var loopElement = wk.chain[wk.loopBackIndex]

                var info = $("<div>").attr("id", "loopInfo").addClass("alert alert-info").append(
                    "This article reaches <strong>" + loopElement.name + "</strong>"
                ).append(
                    " in <strong>" + wk.loopBackIndex + "</strong> articles"
                ).append(
                    " and then loops through <strong>" + (wk.chain.length - wk.loopBackIndex - 1) + "</strong> additional articles"
                )

                $("#chainTable").after(info)

                $("#loopInfo").hide()
                $("#loopInfo").animate({
                    "height":"toggle",
                    "padding-top":"toggle",
                    "padding-bottom":"toggle"
                }, {
                    duration: 400,
                    step: function (now, fx) {
                        $("html,body").scrollTop($(document).height())
                    }
                })

            }

            wk.errorCallback = function () {
                var info = $("<div>").attr("id", "errorInfo").addClass("alert alert-warning").append(
                    "Cannot find an article with this name"
                )

                $("#inputWell").after(info)

                $("#errorInfo").hide()
                $("#errorInfo").slideDown()

                $("#submit,#getRandom").removeAttr("disabled")
            }

            wk.gotRandomCallback = function (random) {
                $("#input").val(random)
                $("#submit,#getRandom").removeAttr("disabled")
            }

            $("#submit").click(function () {

                $(".chain-element").remove()
                $("#loopInfo,#errorInfo").remove()

                wk.seedFromName($("#input").val())
                $("#submit,#getRandom").attr("disabled", "disabled")
                wk.doTrace()
            })

            $("#getRandom").click(function () {

                $("#submit,#getRandom").attr("disabled", "disabled")

                wk.getRandomPageName()
            })

        });
    </script>

</head>

<body>

<div id="mainContainer" class="container">
    <h2>
        Wikipedia Tracer
    </h2>
    <hr>
    <div id="inputWell" class="well">
        <div class="row-fluid">
            <div class="span12">
                <p>Following the first link (not in parentheses or italics) of any Wikipedia article indefinitely will almost always
                   lead you to loop on the 'Philosophy' article. Can you find one that doesn't? Type the name of the starting wikipedia
                   article in the box and click Submit to find out. Or, click Random to try it out with a random article.</p>
            </div>
        </div>
        <hr>
        <div class="row-fluid">
            <div class="span8">
                <input id="input" class="span12" type="text"></input>
            </div>
            <div class="span2">
                <button id="getRandom" class="btn span12 submit-buttons">Random</button>
            </div>
            <div class="span2">
                <button id="submit" class="btn span12 submit-buttons">Submit</button>
            </div>
        </div>
    </div>
    <table id="chainTable" class="table table-striped table-bordered">
        <tbody id="chainBody">
        </tbody>
    </table>
</div>

</body>

</html>